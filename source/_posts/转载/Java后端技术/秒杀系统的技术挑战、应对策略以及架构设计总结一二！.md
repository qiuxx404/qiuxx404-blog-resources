---
title: 秒杀系统的技术挑战、应对策略以及架构设计总结一二！
date: 2018-03-04 14:18:00
category: 架构
tags: [秒杀,架构]
---

## 1.什么是秒杀？

秒杀是电商常见的一种营销手段：将少量的商品，以极低的价格，在特定的时间点开始出售，网站通过这种营销手段，制造某种轰动效应，从而达到网站推广的目的，秒杀虽然对网站推广有很多好处，但是对网站技术却是极大的挑战：网站是为正常运营设计的，而秒杀活动带来的并发访问用户却是平时的数百倍甚至上千倍，网站如果为秒杀时的最大并发访问量去设计部署，就需要比正常运营多很多服务器，而这些服务器在大多数时候都是用不上的，对于成本而言就比较浪费了，所以秒杀业务不能使用正常的网站业务流程，也不能和正常的网站交易业务公用一台服务器，必须设计部署专门的秒杀系统，进行专门应对。

## 2.秒杀的技术挑战

### **2.1 对现有网站业务造成冲击**
秒杀活动只是网站营销的一个附加活动，这个活动具有时间短，并发访问量大的特点，如果和网站原有应用部署在一起，必然会对现有业务造成冲击，稍有不慎可能导致整个网站瘫痪；

### **2.2 高并发下的应用、数据库负载**
用户在秒杀活动开始之前，通过不停的刷新浏览器页面以保证不错过秒杀，这些请求如果按照一般网站的应用架构，访问应用服务器，连接数据库，会对应用服务器和数据库服务器造成极大的负载压力；

### **2.3 突然增加的网络及服务器带宽**
因为访问秒杀页面的用户剧增，对资源的请求量也是剧增，网络带宽也上去了，超过平时网站使用的带宽；

### **2.4 直接下单**
秒杀的规则是到了秒杀秒杀时间才能开始对商品下单购买，在此时间点之前，只能浏览商品信息，不能下单。而下单页面也是一个普通的URL，如果得到了这个URL，不用等到秒杀开始就可以下单了；

## 3.秒杀系统的应对策略

### **3.1 秒杀系统独立部署**
为了避免因为秒杀的高并发访问而拖垮整个网站，使网站不必面对蜂拥而来的用户访问，可将秒杀系统独立部署；如果需要还可以使用独立的域名，使其与网站完全隔离，即使秒杀系统崩溃了，也不会造成网站其他业务正常运行；

### **3.2 秒杀商品页面静态化**
重新设计秒杀商品页面，不使用网站原有的商品详情页，页面内容静态化：将商品描述、商品参数、成交记录和用户评价全部写入一个静态页面，用户请求不需要经过应用服务器的业务逻辑处理，也不需要访问数据库，所以秒杀商品服务不需要部署动态的web服务器和数据库服务器；

### **3.3 租借秒杀活动网络带宽**
因为秒杀新增的网络带宽，必须和运营商重新购买商品或者租借，为了减轻网站服务器的压力，需要将秒杀商品页面缓存在CDN，同样需要和CDN服务商临时租借新增的流量出口带宽；

### **3.4 动态生成随即下单页面URL**
为了避免用户直接访问下单页面URL，需要将该URL动态化，即使秒杀系统的开发者也无法在秒杀之前访问下单页面URL，方案是将下单页面URL加入由服务器端生成的随机数作为参赛，在秒杀开始的时候才能获取得到；

## 4.秒杀系统架构设计

秒杀系统是为秒杀而设计，不同于一般的网购行为，参与秒杀活动的用户更关心的是如何快速刷新商品页面，在秒杀开始的时候抢先进入下单页面，而不是秒杀商品的详情页用户体验细节，因此秒杀系统页面设计应该尽可能的简单，下单表单也尽可能的简单，购买数量只能是一个且不能修改，送货地址和付款方式都使用用户默认设置的，没有默认也可以先不填，允许等订单提交之后修改；只有第一个提交的订单发送给网站的订单子系统，其余用户提交订单后只能看到秒杀结束的页面，另外还有下面几点需要注意的：

### **4.1 如何控制秒杀商品页面按钮是否可点击**
购买按钮在活动开始之前应该要不能点击，当秒杀活动开始才能点击，如果此页面是动态生成的，当然可以在服务器端构造响应页面输出，控制按钮是否可点击，但是为了减轻服务器的负载压力，更好的利用CDN，反向代理等性能优化手段，该页面被设计成静态页面，缓存在CDN、反向代理服务器上，甚至用户浏览器上，秒杀开始时，用户刷新页面，请求根本不会到达应用服务器，解决方案是：使用js脚本控制，在秒杀商品静态页面中加入一个js文件引用，该js文件中加入秒杀是否开始的标志和下单页面URL的随机参数，当秒杀开始时，生成一个新的js文件并被用户浏览器加载，控制秒杀商品页面的展示，这个js文件使用随机版本号，并且不被浏览器、CDN和反向代理服务器缓存，如下图：
 ![](http://p4rffk0h4.bkt.clouddn.com/20180304_%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%8A%80%E6%9C%AF%E6%8C%91%E6%88%98%E3%80%81%E5%BA%94%E5%AF%B9%E7%AD%96%E7%95%A5%E4%BB%A5%E5%8F%8A%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%80%BB%E7%BB%93%E4%B8%80%E4%BA%8C1_%E6%8E%A7%E5%88%B6%E9%A1%B5%E9%9D%A2%E6%8C%89%E9%92%AE.jpg)
这个js文件非常小，即使每次浏览器刷新都访问js文件服务器也不会对服务器集群和网络带宽造成太大的压力。

### **4.2 如何允许第一个提交的订单被发送到订单子系统**
假设最终秒杀成功的用户只有一个，那么如何控制呢，在用户提交订单的时候，就得检查是否有订单已经提交，事实上由于最终能够成功提交的用户只有一个，为了减轻下单页面服务器的负载压力，可以控制进入下单页面的入口，只有少数用户能进入下单页面，其他用户直接进入秒杀结束的页面，假设下单服务器集群有10台服务器，每台服务器只接受最多10个请求下单，如下所示：

![](http://p4rffk0h4.bkt.clouddn.com/20180304_%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%8A%80%E6%9C%AF%E6%8C%91%E6%88%98%E3%80%81%E5%BA%94%E5%AF%B9%E7%AD%96%E7%95%A5%E4%BB%A5%E5%8F%8A%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%80%BB%E7%BB%93%E4%B8%80%E4%BA%8C2_%E6%8E%A7%E5%88%B6%E7%AC%AC%E4%B8%80%E4%B8%AA%E8%AE%A2%E5%8D%95%E6%8F%90%E4%BA%A4%E5%88%B0%E7%B3%BB%E7%BB%9F.jpg)

## 5.秒杀整体系统架构总结
![](http://p4rffk0h4.bkt.clouddn.com/20180304_%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%8A%80%E6%9C%AF%E6%8C%91%E6%88%98%E3%80%81%E5%BA%94%E5%AF%B9%E7%AD%96%E7%95%A5%E4%BB%A5%E5%8F%8A%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%80%BB%E7%BB%93%E4%B8%80%E4%BA%8C3_%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84.jpg)

----------


原文地址：[http://mp.weixin.qq.com/s/62W8aF10YDrCTRzM1TZKpA](http://mp.weixin.qq.com/s/62W8aF10YDrCTRzM1TZKpA "秒杀系统的技术挑战、应对策略以及架构设计总结一二！")